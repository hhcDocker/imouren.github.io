---
layout: post
title:  "mongodb"
date:   2016-11-12 09:15:31
categories: mongodb
tags: mongodb
---

* content
{:toc}

##  文档数据简介

memcached 和 redis 属于key-value数据库

传统数据库：存储的是结构化数据。

文档型数据库：反范式化，很灵活。

mongodb 属于文档型数据库，存储的是(bson--json的二进制化)

特点：内部执行引擎为JS解释器，把文档存储成bson结构；查询时，转换为JS对象，并可以通过js语法来操作。

它在磁盘上进行包装了一层，gridfs文件系统，在gridfs上是bson结构。

## 下载安装

去[官网](http://mongodb.org)下载最新稳定版

解压即可，不需要编译。

启动

```python
sudo  /usr/local/mongodb/bin/mongod --dbpath=/data/db --logpath=/var/log/mongodb/mongodb.log --fork

--dbpath 数据存储目录
--logpath 日志存储目录
--port 运行端口(默认27017)
--fork 后台进程运行

--smallfiles 占用小空间，可以在虚拟机上使用这个参数
```

客户端

```python

./mongo foo
./mongo 192.168.0.5/foo
./mongo 192.168.0.5:9999/foo

```

试着敲些命令

```python
MongoDB server version: 3.4.1

> show dbs;
admin  0.000GB
local  0.000GB
shop   0.000GB
> show databases;
admin  0.000GB
local  0.000GB
shop   0.000GB
> use admin;
switched to db admin
> show tables;
system.version

```


## 库表操作语句

查看库  show dbs; show databases;

选择库  use dbname;

查看库下面的collection  show collections; show tables;

查看帮助  db.help();

```python
> show dbs;
admin  0.000GB
local  0.000GB
shop   0.000GB
> show databases;
admin  0.000GB
local  0.000GB
shop   0.000GB

> use shop;
switched to db shop

> show collections;
user
> show tables;
user

```

创建数据库:  数据库是隐式创建的 直接用 use dbname;

创建collection：  db.createCollection("collection_name");

插入数据(也可以隐式创建collection)：  db.collection_name.insert(document);

"_id"是自动生成的，也可以自己指定

mysql表限制了结构，而mongo不需要限制，所以可以隐式创建

查看数据：  db.collection_name.find();

删除collection:  db.collection_name.drop();

删除数据库:  db.dropDatabase();


```python
> use newdb;
switched to db newdb

> db.createCollection("auser");
{ "ok" : 1 }
> show dbs;
admin  0.000GB
local  0.000GB
newdb  0.000GB
shop   0.000GB
> show tables;
auser

> db.auser.insert({name: "lisi", age:22})
WriteResult({ "nInserted" : 1 })

# 隐式创建collection
> db.buser.insert({name: "lisi", age:22})
WriteResult({ "nInserted" : 1 })
> show tables;
auser
buser

> db.auser.find()
{ "_id" : ObjectId("587482341b173ff4b3f9600c"), "name" : "lisi", "age" : 22 }

# 指定 _id
> db.auser.find()
{ "_id" : ObjectId("587482341b173ff4b3f9600c"), "name" : "lisi", "age" : 22 }
{ "_id" : 1, "name" : "mr" }

# 删除collection
> show tables;
auser
buser
> db.buser.drop();
true
> show tables;
auser

# 删除库
> db.dropDatabase();
{ "dropped" : "newdb", "ok" : 1 }
> show dbs;
admin  0.000GB
local  0.000GB
shop   0.000GB
```







